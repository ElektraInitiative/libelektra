
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>How to Write a specification in Elektra</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="elektra-specification"
                  title="How to Write a specification in Elektra"
                  environment="web"
                  feedback-link="https://libelektra.org">
    
      <google-codelab-step label="Overview" duration="1">
        <p class="image-container"><img alt="elektra-logo" src="img/f3d8fe70ccd493c.svg"></p>
<h2 is-upgraded>Introduction</h2>
<p>In this codelab you will learn how to interactively use the <code>SpecElektra</code> specification language and <code>kdb</code> to write a configuration specification for an example application.</p>
<h2 is-upgraded>What you should already know</h2>
<ul>
<li>how to install elektra</li>
<li>very basic elektra commands and concepts (kdb get, kdb set, kdb ls)</li>
<li>how to open and use a terminal</li>
</ul>
<h2 class="checklist" is-upgraded>What you&#39;ll Learn</h2>
<ul>
<li>how to create and mount a specification using <code>kdb</code></li>
<li>how to add keys with different types, defaults and examples to your specification and how to validate them</li>
<li>the benefits of using <code>kdb</code> to generate a specification, instead of writing one by hand</li>
</ul>
<h2 is-upgraded>What you&#39;ll do</h2>
<ul>
<li>use code generation and <code>kdb</code> to create and mount a specification for an example CRUD application</li>
<li>define defaults, examples and checks for keys in the validation</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Example App Overview" duration="1">
        <p>For this tutorial we will write a specification for a very simple CRUD backend application. You need to configure a <code>port</code> for the REST server, an <code>ip</code> and a SQL <code>dialect</code> for the database server the app will connect to and finally a <code>date</code> where all the data will be saved to a backup.</p>
<p>So the application will need the following configuration options:</p>
<ul>
<li>a server port</li>
<li>a database ip</li>
<li>a database dialect</li>
<li>a backup date</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Getting Started" duration="3">
        <p>Make sure you have <code>Elektra</code> installed on your local machine.</p>
<pre><code>kdb --version

KDB_VERSION: 0.9.5
SO_VERSION: 5
</code></pre>
<p>Otherwise refer to the <a href="https://www.libelektra.org/getstarted/guide" target="_blank">getting started guide</a> to install it.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Task: Mounting the specification" duration="5">
        <h2 is-upgraded>Step 1: Mount a specification file</h2>
<p>First you need to mount a specification file, in this case <code>spec.ni</code> to the <code>spec:/</code> namespace. We define the path inside the <code>spec:/</code> namespace as <code>/sw/app/current/#0</code>, this is an arbitrary name and you can choose whatever you want here.</p>
<p>We also need the specify the plugin we use for writing to the file in the correct format. In this case we choose the <code>ni</code> plugin to write to the specification file.</p>
<pre><code language="language-bash" class="language-bash">kdb mount ~/spec.ni spec:/sw/app/current/#0 ni
</code></pre>
<h2 is-upgraded>Step 2: Define a mountpoint</h2>
<p>Next we can define, that this specification defines a specific mountpoint for a concrete application configuration. So we say the concrete configuraion should be written to <code>app.ni</code>.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0 mountpoint app.ni
</code></pre>
<p>Your <code>spec.ni</code> file should now look something like this:</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

 =

[]
 meta:/mountpoint = app.ni
</code></pre>
<h2 is-upgraded>Step 3: Do a specification mount</h2>
<pre><code language="language-bash" class="language-bash">kdb spec-mount /sw/app/current/#0 ni
</code></pre>
<p>This specification mount makes sure that the paths where the concrete configuration should be, in this case <code>app.ni</code>, are ready to fulfill or specification, in this case <code>spec.ni</code>.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Task: Adding your first key to the specification" duration="5">
        <h2 is-upgraded>Step 1: Adding the server port</h2>
<p>The first key you will add to our specification will be the port of the server. You add it using the following command below.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/server/port type short
</code></pre>
<p>What you also specified in the command above is the type of the configuration key. Elektra uses the <a href="https://www.libelektra.org/plugins/type" target="_blank">CORBA type system</a> and will check that keys conform to the type specified.</p>
<p>So after adding the initial key your specification should look something like this:</p>
<pre><code>cat ~/spec.ni


;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

 =
server/port =

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/type = short
</code></pre>
<h2 is-upgraded>Step 2: Adding more metadata</h2>
<p>So with your first key added, we of course want to specify more information for the port. There surely is more information to a port than just the type. What about a <code>default</code>, or what about an <code>example</code> for a usable port? Maybe a <code>description</code> what the port really is for? Let&#39;s add that next!</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/server/port default 8080
kdb meta-set spec:/sw/app/current/#0/server/port example 8080
kdb meta-set spec:/sw/app/current/#0/server/port description &#34;port of the REST server that runs the application&#34;
</code></pre>
<p>Beautiful! Your specification is starting to look like something useful. But wait! Shouldn&#39;t a port just use values between <code>1</code> and <code>65535</code>?</p>
<p>Of course Elektra also has a plugin for that. We can just use the <a href="https://www.libelektra.org/plugins/network" target="_blank">network</a> checker plugin.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/server/port check/port &#39;&#39;
</code></pre>
<p>Nice! You just have to do one more thing when using a new plugin. Elektra needs to remount the spec to use the new plugin. Use the command from before:</p>
<pre><code language="language-bash" class="language-bash">kdb spec-mount /sw/app/current/#0 ni
</code></pre>
<p>Your final specification after adding the port should now look something like this</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

 =
server/port =

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/check/port =
 meta:/type = short
 meta:/example = 8080
 meta:/description = port of the REST server that runs the application
 meta:/default = 8080
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Task: Adding the database keys to the specification" duration="5">
        <h2 is-upgraded>Step 1: Adding the database ip</h2>
<p>Next up you will add a key for the database <code>ip</code> address. Like with the key before, you will add a <code>type</code>, <code>default</code>, <code>example</code> and a <code>description</code> so that the configuration will be easily usable.</p>
<p>Don&#39;t forget the most important rule of configurations: <strong>Always add sensible defaults!</strong></p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/database/ip type string
kdb meta-set spec:/sw/app/current/#0/database/ip default 127.0.0.1
kdb meta-set spec:/sw/app/current/#0/database/ip example 127.0.0.1
kdb meta-set spec:/sw/app/current/#0/database/ip description &#34;ip address of the database server, that the application will connect to&#34;
kdb meta-set spec:/sw/app/current/#0/database/ip check/ipaddr &#39;&#39;
</code></pre>
<p>After this meta-setting bonanza your specification file should look something like this:</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

database/ip =
 =
server/port =

[database/ip]
 meta:/check/ipaddr =
 meta:/type = string
 meta:/example = 127.0.0.1
 meta:/description = ip address of the database server, that the application will connect to
 meta:/default = 127.0.0.1

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/check/port =
 meta:/type = short
 meta:/example = 8080
 meta:/description = port of the REST server that runs the application
 meta:/default = 8080
</code></pre>
<h2 is-upgraded>Step 2: Adding the database dialect</h2>
<p>Next up you will add a key for the SQL <code>dialect</code> the database will use. Since there are only a few databases your application will support, you can define the possible dialects via an <a href="https://www.libelektra.org/plugins/type#enums" target="_blank">enum</a> type. This allows us to prohibit all other possible dialects that are not SQL.</p>
<p>First you define the size of the <code>enum</code> type, and then you can add the different <code>enum</code> values.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/database/dialect type enum
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum &#34;#4&#34;
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum/#0 postgresql
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum/#1 mysql
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum/#2 mssql
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum/#3 mariadb
kdb meta-set spec:/sw/app/current/#0/database/dialect check/enum/#4 sqlite
</code></pre>
<p>Afterwards you define all the other parameters, just as before.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/database/dialect default mssql
kdb meta-set spec:/sw/app/current/#0/database/dialect example mysql
kdb meta-set spec:/sw/app/current/#0/database/dialect description &#34;SQL dialect of the database server, that the application will connect to (postgresql|mysql|mssql|mariadb|sqlite)&#34;
</code></pre>
<p>After this your specification file should look something like this:</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

database/ip =
 =
server/port =
database/dialect =

[database/ip]
 meta:/check/ipaddr =
 meta:/type = string
 meta:/example = 127.0.0.1
 meta:/description = ip address of the database server, that the application will connect to
 meta:/default = 127.0.0.1

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/check/port =
 meta:/type = short
 meta:/example = 8080
 meta:/description = port of the REST server that runs the application
 meta:/default = 8080

[database/dialect]
 meta:/check/enum/#2 = mssql
 meta:/check/enum/#0 = postgresql
 meta:/type = enum
 meta:/check/enum/#1 = mysql
 meta:/example = mysql
 meta:/description = SQL dialect of the database server, that the application will connect to (postgresql|mysql|mssql|mariadb|sqlite)
 meta:/check/enum/#4 = sqlite
 meta:/check/enum/#3 = mariadb
 meta:/default = mssql
 meta:/check/enum = #4
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Task: Adding the backup date" duration="3">
        <p>The last key we will add to our application is a <code>date</code> key for the annual backup and restart (this should probably not be annually in a real application). Here we use the <a href="https://www.libelektra.org/plugins/date" target="_blank">check/date</a> plugin with the <code>ISO8601</code> format. We also specify a <code>check/date/format</code>. You can find all possible date formats on the <a href="https://www.libelektra.org/plugins/date" target="_blank">plugin page</a>. For this we can use the following commands:</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/backup/date type string
kdb meta-set spec:/sw/app/current/#0/backup/date check/date ISO8601
kdb meta-set spec:/sw/app/current/#0/backup/date check/date/format &#34;calendardate complete extended&#34;
</code></pre>
<p>Then just add examples, defaults and description as always.</p>
<pre><code language="language-bash" class="language-bash">kdb meta-set spec:/sw/app/current/#0/backup/date default 2021-11-01
kdb meta-set spec:/sw/app/current/#0/backup/date example 2021-01-12
kdb meta-set spec:/sw/app/current/#0/backup/date description &#34;date of the annual server and database backup&#34;
</code></pre>
<p>Your specification looks to be complete now! Make sure it look something like the one below and you are good to go using it and configuring the heck out of it!</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

backup/date =
database/ip =
 =
server/port =
database/dialect =

[backup/date]
 meta:/check/date/format = calendardate complete extended
 meta:/type = string
 meta:/example = 2021-01-12
 meta:/description = date of the annual server and database backup
 meta:/default = 2021-11-01
 meta:/check/date = ISO8601

[database/ip]
 meta:/check/ipaddr =
 meta:/type = string
 meta:/example = 127.0.0.1
 meta:/description = ip address of the database server, that the application will connect to
 meta:/default = 127.0.0.1

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/check/port =
 meta:/type = short
 meta:/example = 8080
 meta:/description = port of the REST server that runs the application
 meta:/default = 8080

[database/dialect]
 meta:/check/enum/#2 = mssql
 meta:/check/enum/#0 = postgresql
 meta:/type = enum
 meta:/check/enum/#1 = mysql
 meta:/example = mysql
 meta:/description = SQL dialect of the database server, that the application will connect to (postgresql|mysql|mssql|mariadb|sqlite)
 meta:/check/enum/#4 = sqlite
 meta:/check/enum/#3 = mariadb
 meta:/default = mssql
 meta:/check/enum = #4
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Final specification code" duration="1">
        <p>After adding all the keys that are necessary for our application to the server, your specification should look something like this:</p>
<pre><code language="language-bash" class="language-bash">cat ~/spec.ni

;Ni1
; Generated by the ni plugin using Elektra (see libelektra.org).

backup/date =
database/ip =
 =
server/port =
database/dialect =

[backup/date]
 meta:/check/date/format = calendardate complete extended
 meta:/type = string
 meta:/example = 2021-01-12
 meta:/description = date of the annual server and database backup
 meta:/default = 2021-11-01
 meta:/check/date = ISO8601

[database/ip]
 meta:/check/ipaddr =
 meta:/type = string
 meta:/example = 127.0.0.1
 meta:/description = ip address of the database server, that the application will connect to
 meta:/default = 127.0.0.1

[]
 meta:/mountpoint = app.ni

[server/port]
 meta:/check/port =
 meta:/type = short
 meta:/example = 8080
 meta:/description = port of the REST server that runs the application
 meta:/default = 8080

[database/dialect]
 meta:/check/enum/#2 = mssql
 meta:/check/enum/#0 = postgresql
 meta:/type = enum
 meta:/check/enum/#1 = mysql
 meta:/example = mysql
 meta:/description = SQL dialect of the database server, that the application will connect to (postgresql|mysql|mssql|mariadb|sqlite)
 meta:/check/enum/#4 = sqlite
 meta:/check/enum/#3 = mariadb
 meta:/default = mssql
 meta:/check/enum = #4
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Summary" duration="1">
        <ul>
<li>You setup and mounted a specification using <code>kdb mount</code> and <code>kdb spec-mount</code></li>
<li>You added keys the specification using <code>kdb meta-set</code></li>
<li>You added different types of keys with <code>type string</code> or <code>type short</code></li>
<li>You added keys with enum types, to get specific configuration values, with &#34;</li>
<li>You added default parameters, examples and descriptions with <code>example</code>, <code>default</code>, <code>description</code></li>
<li>You also added validation checks using different plugins, like <code>check/port</code>, <code>check/ipaddr</code> or</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Learn more" duration="1">
        <p>Tutorials on the Elektra homepage:</p>
<ul>
<li><a href="https://www.libelektra.org/tutorials/readme" target="_blank">Tutorial Overview</a></li>
</ul>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
